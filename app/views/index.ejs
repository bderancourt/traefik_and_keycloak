<!DOCTYPE html>
<html>
<head>
    <title>OIDC Demo - Traefik + Keycloak</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .login-btn { 
            display: inline-block;
            padding: 15px 30px; 
            margin: 20px 0; 
            text-decoration: none; 
            background: #007bff; 
            color: white; 
            border-radius: 5px; 
            font-size: 16px;
            transition: background 0.3s;
        }
        .login-btn:hover { background: #0056b3; }
        .logout-btn { 
            display: inline-block;
            padding: 10px 20px; 
            margin-top: 20px; 
            text-decoration: none; 
            background: #dc3545; 
            color: white; 
            border-radius: 5px; 
        }
        .logout-btn:hover { background: #c82333; }
        .info { background: #e9ecef; padding: 20px; border-radius: 5px; margin: 20px 0; }
        .user-info { background: #d4edda; padding: 20px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #28a745; }
        .success { color: #28a745; }
        .welcome { color: #6c757d; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <% if (authenticated && user) { %>
            <!-- Authenticated state - Protected content -->
            <h1 class="success">üéâ Welcome to the Secured Area!</h1>
            
            <div class="user-info">
                <h3>Your Profile Information</h3>
                <p><strong>Username:</strong> <%= user.preferred_username || 'N/A' %></p>
                <p><strong>Email:</strong> <%= user.email || 'N/A' %></p>
                <p><strong>Full Name:</strong> <%= user.name || user.given_name + ' ' + user.family_name || 'N/A' %></p>
                <p><strong>Subject ID:</strong> <%= user.sub || 'N/A' %></p>
                <% if (user.realm_access && user.realm_access.roles) { %>
                <p><strong>Roles:</strong> <%= user.realm_access.roles.join(', ') %></p>
                <% } %>
            </div>

            <div class="info">
                <h3>üîí Authentication Status</h3>
                <ul>
                    <li>‚úÖ Successfully authenticated via Keycloak OIDC</li>
                    <li>‚úÖ Token validated with proper ISS handling</li>
                    <li>‚úÖ Routed through Traefik reverse proxy</li>
                    <li>‚úÖ Session secured and maintained</li>
                </ul>
                <p><small><strong>Technical:</strong> X-Forwarded headers ensure proper proxy-aware token validation</small></p>
            </div>

            <a href="/logout" class="logout-btn">üö™ Logout</a>
            
        <% } else { %>
            <!-- Non-authenticated state - Login page -->
            <h1>üîê OIDC Authentication Demo</h1>
            <p class="welcome">This demo showcases secure authentication using <strong>Keycloak OIDC</strong> through <strong>Traefik</strong> reverse proxy.</p>
            
            <div class="info">
                <h3>Architecture Overview</h3>
                <ul>
                    <li><strong>Traefik:</strong> Reverse proxy with automatic HTTPS</li>
                    <li><strong>Keycloak:</strong> Identity Provider with OIDC support</li>
                    <li><strong>Demo App:</strong> Node.js Express with keycloak-connect</li>
                </ul>
            </div>

            <p>Click below to authenticate and access the secured area:</p>
            <a href="/login" class="login-btn">üîë Login with Keycloak</a>
        <% } %>
    </div>
</body>
</html>